# traefik.yml
api:
  dashboard: true
  insecure: true

providers:
  docker:
    exposedByDefault: false

entryPoints:
  web:
    address: ":80"
    # –î–æ–¥–∞–Ω–æ: –ì–ª–æ–±–∞–ª—å–Ω–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è HTTP -> HTTPS
    http:
      redirections:
        entryPoint:
          to: "websecure"
          scheme: "https"
  websecure:
    address: ":443"

certificatesResolvers:
  myresolver:
    acme:
      email: "your@gmail.com"
      storage: /etc/traefik/acme.json
      # –í–ò–ü–†–ê–í–õ–ï–ù–û: –ü—Ä–∞–≤–∏–ª—å–Ω–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –¥–ª—è tlsChallenge
      tlsChallenge: {}
      # –°—Ç–∞—Ä–∏–π —Ä—è–¥–æ–∫ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω-—Å–µ—Ä–≤–µ—Ä–∞ Let's Encrypt
      caServer: https://acme-v02.api.letsencrypt.org/directory
      # –ù–æ–≤–∏–π —Ä—è–¥–æ–∫ –¥–ª—è staging-—Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è.
      # caserver: https://acme-staging-v02.api.letsencrypt.org/directory
log:
  level: DEBUG

# üëá –ü–û–ß–ê–¢–û–ö –î–û–î–ê–ù–ò–• –ó–ú–Ü–ù –î–õ–Ø –¢–ê–ô–ú–ê–£–¢–Ü–í üëá

http:
  routers:
    n8n:
      rule: "Host(`${SUBDOMAIN}.${DOMAIN_NAME}`)"
      entrypoints:
        - "websecure"
      service: "n8n"
      tls:
        certResolver: "myresolver"
      # –í–ò–ü–†–ê–í–õ–ï–ù–û: –í–∏–¥–∞–ª–µ–Ω–æ "@docker" –∑ –Ω–∞–∑–≤–∏ middleware
      middlewares:
        - "n8n-timeouts" 

  services:
    n8n:
      loadBalancer:
        servers:
          - url: "http://n8n_main:5678"
        passHostHeader: true

  middlewares:
    n8n-timeouts:
      # –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç–∞–π–º–∞—É—Ç—ñ–≤, —è–∫—ñ –±—É–¥—É—Ç—å –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω—ñ –¥–æ —Å–µ—Ä–≤—ñ—Å—É n8n
      timeouts:
        idleTimeout: 300s
        readTimeout: 300s
        writeTimeout: 300s
